<div class="container">
  <form [formGroup]="form" (ngSubmit)="aceptar()" style="margin: 2rem">
    <h2 style="text-align: center; margin-top: 2rem">
      {{ edicion ? "Editar Usuario" : "Registrar Usuario" }}
    </h2>

    <!-- DNI -->
    <mat-form-field appearance="fill" class="w-100">
      <mat-label>DNI</mat-label>
      <input matInput formControlName="dni" />
      <mat-error *ngIf="form.get('dni')?.hasError('required') && form.get('dni')?.touched">
        El DNI es obligatorio.
      </mat-error>
      <mat-error *ngIf="form.get('dni')?.hasError('pattern') && form.get('dni')?.touched">
        El DNI debe contener exactamente 8 dígitos numéricos.
      </mat-error>
    </mat-form-field>

    <!-- Nombres -->
    <mat-form-field appearance="fill" class="w-100">
      <mat-label>Nombres</mat-label>
      <input matInput formControlName="nombres" />
      <mat-error *ngIf="form.get('nombres')?.hasError('required')">
        El nombre es obligatorio.
      </mat-error>
    </mat-form-field>

    <!-- Apellidos -->
    <mat-form-field appearance="fill" class="w-100">
      <mat-label>Apellidos</mat-label>
      <input matInput formControlName="apellidos" />
      <mat-error *ngIf="form.get('apellidos')?.hasError('required')">
        Los apellidos son obligatorios.
      </mat-error>
    </mat-form-field>

    <!-- Dirección -->
    <mat-form-field appearance="fill" class="w-100">
      <mat-label>Dirección</mat-label>
      <input matInput formControlName="direccion" />
      <mat-error *ngIf="form.get('direccion')?.hasError('required')">
        La dirección es obligatoria.
      </mat-error>
    </mat-form-field>

    <!-- Correo electrónico -->
    <mat-form-field appearance="fill" class="w-100">
      <mat-label>Correo electrónico</mat-label>
      <input matInput formControlName="correo_electronico" />
      <mat-error *ngIf="form.get('correo_electronico')?.hasError('required') && form.get('correo_electronico')?.touched">
        El correo es obligatorio.
      </mat-error>
      <mat-error *ngIf="form.get('correo_electronico')?.hasError('email') && form.get('correo_electronico')?.touched">
        Ingresa un correo electrónico válido.
      </mat-error>
    </mat-form-field>

    <!-- Fecha de nacimiento -->
    <mat-form-field appearance="fill" class="w-100">
      <mat-label>Fecha de nacimiento</mat-label>
      <input matInput [matDatepicker]="picker" formControlName="fechaNacimiento" />
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
      <mat-error *ngIf="form.get('fechaNacimiento')?.hasError('required')">
        La fecha de nacimiento es obligatoria.
      </mat-error>
      <mat-error *ngIf="form.get('fechaNacimiento')?.hasError('menorDeEdad')">
        Debe ser mayor de 18 años.
      </mat-error>
    </mat-form-field>

    <!-- Edad (solo visible en edición) -->
    <mat-form-field appearance="fill" class="w-100" *ngIf="edicion">
      <mat-label>Edad</mat-label>
      <input matInput formControlName="edad" readonly />
    </mat-form-field>

    <!-- Teléfono -->
    <mat-form-field appearance="fill" class="w-100">
      <mat-label>Teléfono</mat-label>
      <input matInput formControlName="telefono" />
      <mat-error *ngIf="form.get('telefono')?.hasError('required')">
        El teléfono es obligatorio.
      </mat-error>
      <mat-error *ngIf="form.get('telefono')?.hasError('pattern')">
        El teléfono debe tener 9 dígitos y empezar con 9.
      </mat-error>
    </mat-form-field>

    <!-- Username -->
    <mat-form-field appearance="fill" class="w-100">
      <mat-label>Username</mat-label>
      <input matInput formControlName="username" />
      <mat-error *ngIf="form.get('username')?.hasError('required')">
        El username es obligatorio.
      </mat-error>
      <mat-error *ngIf="form.get('username')?.hasError('minlength')">
        Mínimo 4 caracteres.
      </mat-error>
    </mat-form-field>

    <!-- Password (solo en registro) -->
    <mat-form-field appearance="fill" class="w-100" *ngIf="!edicion">
      <mat-label>Password</mat-label>
      <input matInput type="password" formControlName="password" />
      <mat-error *ngIf="form.get('password')?.hasError('required')">
        El password es obligatorio.
      </mat-error>
      <mat-error *ngIf="form.get('password')?.hasError('minlength')">
        Mínimo 6 caracteres.
      </mat-error>
    </mat-form-field>

    <!-- Estado (solo en registro) -->
    <mat-radio-group formControlName="enabled" *ngIf="!edicion">
      <mat-radio-button [value]="true">Activo</mat-radio-button>
      <mat-radio-button [value]="false">Inactivo</mat-radio-button>
    </mat-radio-group>

    <!-- Botones -->
    <div class="botones-acciones">
      <button mat-raised-button type="submit" [disabled]="form.invalid">
        Aceptar
      </button>

      <button mat-raised-button type="button" (click)="cancelar()" class="btn-cancelar">
        Cancelar
      </button>
    </div>
  </form>
</div>
